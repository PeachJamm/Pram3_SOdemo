# PRAM3 SO SPA å‰ç«¯è®¾è®¡æ–‡æ¡£

## ç‰ˆæœ¬ä¿¡æ¯
- åˆ›å»ºæ—¥æœŸï¼š2026-02-18
- ç‰ˆæœ¬ï¼šv1.1
- çŠ¶æ€ï¼šå·²æ›´æ–°ï¼ˆæµç¨‹è¿›åº¦æ¡æ¨ªå‘åŒ–ã€å¿«æ·å¯¼èˆªæµ®åŠ¨åŒ–ã€Chatbotæ¥å£é¢„ç•™ï¼‰

---

## 1. æ•´ä½“æ¶æ„

### 1.1 æŠ€æœ¯æ ˆ
| å±‚çº§ | æŠ€æœ¯ | ç”¨é€” |
|------|------|------|
| å‰ç«¯æ¡†æ¶ | React 18 + TypeScript | SPAåº”ç”¨ |
| çŠ¶æ€ç®¡ç† | Zustand | å…¨å±€çŠ¶æ€ |
| UIç»„ä»¶ | Ant Design Mobile | å“åº”å¼UI |
| å®æ—¶é€šä¿¡ | Socket.io-client | WebSocketæ¨é€ |
| æ‰‹åŠ¿äº¤äº’ | react-swipeable | å·¦æ»‘å³æ»‘ |
| PWA | Workbox | ç¦»çº¿æ”¯æŒ |

### 1.2 ç³»ç»Ÿé›†æˆ
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å‰ç«¯ (React SPA)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚SO SPA   â”‚ â”‚æµç¨‹å›¾   â”‚ â”‚History  â”‚ â”‚å¿«æ·å¯¼èˆª â”‚          â”‚
â”‚  â”‚Componentâ”‚ â”‚ç»„ä»¶     â”‚ â”‚æ—¶é—´è½´   â”‚ â”‚ç»„ä»¶     â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜          â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                         â”‚                                   â”‚
â”‚                    Zustand Store                            â”‚
â”‚                         â”‚                                   â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚              â–¼                     â–¼                       â”‚
â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚       â”‚ Camunda API â”‚      â”‚ WebSocket   â”‚                 â”‚
â”‚       â”‚  (REST)     â”‚      â”‚  (Socket.io)â”‚                 â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚                   â”‚
               â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Node.js åç«¯æœåŠ¡                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ REST API    â”‚  â”‚ ZeebeClient â”‚  â”‚ Socket.io   â”‚         â”‚
â”‚  â”‚ (Express)   â”‚  â”‚ (zeebe-node)â”‚  â”‚ Server      â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                          â”‚                â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                â”‚
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â–¼                                        â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ Camunda 8   â”‚                          â”‚   å‰ç«¯      â”‚
       â”‚  (Zeebe)    â”‚                          â”‚  (æµè§ˆå™¨)   â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. æƒé™ä½“ç³»

### 2.1 æƒé™å®šä¹‰
| æƒé™çº§åˆ« | æ•°æ®åº“Role | åŠŸèƒ½ | ç•Œé¢å…ƒç´  |
|---------|-----------|------|---------|
| **VIEW** | éSalesè§’è‰²ï¼ˆå¦‚CUSTOMER_SERVICEï¼‰ | æŸ¥çœ‹SOè¯¦æƒ…ã€æŸ¥çœ‹å®¡æ‰¹å†å² | æ‰€æœ‰è¡¨å•å­—æ®µåªè¯»ï¼Œæ— æ“ä½œæŒ‰é’® |
| **EDIT** | SALES_REP | åˆ›å»ºSOã€ç¼–è¾‘SOä¸šåŠ¡å­—æ®µ | å®¢æˆ·/äº§å“/æ•°é‡å¯ç¼–è¾‘ï¼Œæäº¤æŒ‰é’®ï¼Œæ— å®¡æ‰¹åŒºåŸŸ |
| **APPROVE** | ç”±DMNåŠ¨æ€åˆ†é…ï¼ˆassigneeï¼‰ | å®¡æ‰¹å†³ç­– | ä¸šåŠ¡å­—æ®µåªè¯»ï¼Œæ˜¾ç¤ºå®¡æ‰¹å†³ç­–åŒºï¼ˆåŒæ„/æ‹’ç»/å›é€€ï¼‰ |

### 2.2 æƒé™åˆ¤å®šé€»è¾‘
```typescript
function getPermissionLevel(user: User, task: Task): PermissionLevel {
  // 1. æ£€æŸ¥æ˜¯å¦æ˜¯DMNåˆ†é…çš„å®¡æ‰¹äºº
  if (task.assignee === user.id) {
    return 'APPROVE';
  }
  
  // 2. æ£€æŸ¥æ•°æ®åº“è§’è‰²
  if (user.role === 'SALES_REP' && task.status === 'CREATED') {
    return 'EDIT';
  }
  
  // 3. é»˜è®¤åªè¯»
  return 'VIEW';
}
```

### 2.3 è¡¨å•å­—æ®µæƒé™æ˜ å°„
```typescript
interface FieldPermission {
  field: string;
  VIEW: { visible: boolean; readonly: boolean };
  EDIT: { visible: boolean; readonly: boolean };
  APPROVE: { visible: boolean; readonly: boolean };
}

const FIELD_PERMISSIONS: FieldPermission[] = [
  // ä¸šåŠ¡å­—æ®µ
  { field: 'customerId',     VIEW: {visible:true, readonly:true},  EDIT: {visible:true, readonly:false}, APPROVE: {visible:true, readonly:true} },
  { field: 'items',          VIEW: {visible:true, readonly:true},  EDIT: {visible:true, readonly:false}, APPROVE: {visible:true, readonly:true} },
  { field: 'totalAmount',    VIEW: {visible:true, readonly:true},  EDIT: {visible:true, readonly:true},  APPROVE: {visible:true, readonly:true} },
  
  // å®¡æ‰¹åŒºåŸŸ
  { field: 'approvalDecision', VIEW: {visible:false, readonly:true}, EDIT: {visible:false, readonly:true}, APPROVE: {visible:true, readonly:false} },
  { field: 'approvalComment',  VIEW: {visible:false, readonly:true}, EDIT: {visible:false, readonly:true}, APPROVE: {visible:true, readonly:false} },
  
  // æ“ä½œæŒ‰é’®
  { field: 'submitBtn',      VIEW: {visible:false, readonly:true}, EDIT: {visible:true, readonly:false}, APPROVE: {visible:false, readonly:true} },
  { field: 'approveBtn',     VIEW: {visible:false, readonly:true}, EDIT: {visible:false, readonly:true}, APPROVE: {visible:true, readonly:false} },
];
```

---

## 3. é¡µé¢å¸ƒå±€

### 3.1 æ¡Œé¢ç«¯å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HEADERæ  (å›ºå®šé«˜åº¦ 60px)                                         â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ SOç¼–å·: SO-20240218-001  â”‚  çŠ¶æ€: å¾…å®¡æ‰¹  â”‚  å®¢æˆ·: ä¸Šæµ·åˆ›æ–°é›†å›¢â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æµç¨‹è¿›åº¦æ¡ (å›ºå®šé«˜åº¦ 80px)                                        â”‚
â”‚ [ğŸ‘¤åˆ›å»º]â”€â†’â”€[ğŸ‘¤éªŒè¯]â”€â†’â”€[ğŸ§ ç¡®å®šçº§åˆ«]â”€â†’â”€[ğŸ‘¤æ€»ç›‘å®¡æ‰¹]â”€â†’â”€[ğŸ§ è®¡ç®—æŠ˜æ‰£]   â”‚
â”‚   âœ“ç»¿è‰²      â³æ©™è‰²      â—‹ç°è‰²         â—‹ç°è‰²        â—‹ç°è‰²        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           â”‚                                     â”‚
â”‚     FLOWå±•ç¤ºåŒº            â”‚      HISTORYæ—¶é—´è½´                  â”‚
â”‚   (flex: 1, å¯æ»šåŠ¨)       â”‚   (å›ºå®šå®½åº¦ 300px)                   â”‚
â”‚                           â”‚                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   18:00 é”€å”®åˆ›å»ºè®¢å•                  â”‚
â”‚   â”‚ SOä¿¡æ¯å¡ç‰‡         â”‚   â”‚   18:05 æäº¤å®¡æ‰¹                     â”‚
â”‚   â”‚ å®¢æˆ·/é‡‘é¢/äº§å“     â”‚   â”‚   18:10 ğŸ§ ç³»ç»Ÿ:å®¡æ‰¹çº§åˆ«=DIRECTOR      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                  â”‚
â”‚                           â”‚   å½“å‰æ­¥éª¤                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   18:15 ğŸ‘¤ç­‰å¾…æ€»ç›‘å®¡æ‰¹                â”‚
â”‚   â”‚ å½“å‰æ“ä½œ: è®¢å•éªŒè¯  â”‚   â”‚                                     â”‚
â”‚   â”‚                   â”‚   â”‚                                     â”‚
â”‚   â”‚ [éªŒè¯é€šè¿‡] [éœ€ä¿®æ”¹]â”‚   â”‚                                     â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                                     â”‚
â”‚                           â”‚                                     â”‚
â”‚                           â”‚   å¿«æ·å¯¼èˆª                            â”‚
â”‚                           â”‚   â”Œâ”€â”€â”€â”€â”€â”                            â”‚
â”‚                           â”‚   â”‚åˆ›å»º â”‚â†’ â”Œâ”€â”€â”€â”€â”€â”                   â”‚
â”‚                           â”‚   â””â”€â”€â”€â”€â”€â”˜   â”‚éªŒè¯ â”‚â†’ â”Œâ”€â”€â”€â”€â”€â”          â”‚
â”‚                           â”‚             â””â”€â”€â”€â”€â”€â”˜   â”‚å®¡æ‰¹ â”‚          â”‚
â”‚                           â”‚                       â””â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                           â”‚                          â†‘            â”‚
â”‚                           â”‚                       å½“å‰æ©™è‰²        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 ç§»åŠ¨ç«¯å¸ƒå±€
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SO-001 Â¥50,000  â”‚  â† Headerç²¾ç®€
â”‚ [å¾…å®¡æ‰¹]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å½“å‰: æ€»ç›‘å®¡æ‰¹   â”‚  â† æµç¨‹æ­¥éª¤ç®€åŒ–ä¸ºæ–‡å­—+å›¾æ ‡
â”‚ â–¼ è®¢å•è¯¦æƒ…      â”‚  â† å¯æŠ˜å 
â”‚   å®¢æˆ·: ä¸Šæµ·åˆ›æ–° â”‚
â”‚   äº§å“: æœåŠ¡å™¨  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å®¡æ‰¹æ„è§        â”‚  â† å½“å‰æ“ä½œåŒº
â”‚ [__________]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â†å·¦æ»‘æ‹’ç»      â”‚  â† æ‰‹åŠ¿æç¤º
â”‚ å³æ»‘åŒæ„â†’      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [åŒæ„] [æ‹’ç»]   â”‚  â† åº•éƒ¨å›ºå®šæŒ‰é’®
â”‚ [å›é€€]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“‹ å†å²è®°å½•     â”‚  â† åº•éƒ¨Tab
â”‚ ğŸ‘¤ æˆ‘çš„å¾…åŠ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. æµç¨‹å›¾ç»„ä»¶

### 4.1 æ˜¾ç¤ºè§„åˆ™
| èŠ‚ç‚¹ç±»å‹ | æ˜¾ç¤ºæ¡ä»¶ | å›¾æ ‡ | é¢œè‰²çŠ¶æ€ |
|---------|---------|------|---------|
| UserTask | æ‰€æœ‰ | ğŸ‘¤ | å·²å®Œæˆ=ç»¿è‰²#52c41a, å½“å‰=æ©™è‰²#fa8c16, æœªè¿›è¡Œ=ç°è‰²#d9d9d9 |
| BusinessRuleTask | æ‰€æœ‰ | ğŸ§  | å·²å®Œæˆ=ç»¿è‰²#52c41a, å½“å‰=è“è‰²#1890ff, æœªè¿›è¡Œ=ç°è‰²#d9d9d9 |
| ServiceTask | ä¸æ˜¾ç¤º | - | - |
| Gateway | ä¸æ˜¾ç¤º | - | - |

### 4.2 æ•°æ®æ¥æº
```typescript
// è§£æBPMN XMLè·å–èŠ‚ç‚¹é¡ºåº
function parseProcessFlow(bpmnXml: string): ProcessNode[] {
  const doc = new DOMParser().parseFromString(bpmnXml, 'text/xml');
  const nodes: ProcessNode[] = [];
  
  // åªæå– UserTask å’Œ BusinessRuleTask
  const userTasks = doc.querySelectorAll('userTask');
  const ruleTasks = doc.querySelectorAll('businessRuleTask');
  
  // æŒ‰æµç¨‹é¡ºåºæ’åº
  // ...
  
  return nodes;
}
```

### 4.3 äº¤äº’é™åˆ¶
- **ä¸å¯ç‚¹å‡»**ï¼šæµç¨‹å›¾åªä½œå±•ç¤ºï¼Œä¸èƒ½ç‚¹å‡»è·³è½¬
- **å½“å‰èŠ‚ç‚¹é«˜äº®**ï¼šä½¿ç”¨æ©™è‰²/è“è‰²è¾¹æ¡†é—ªçƒæ•ˆæœ

---

## 5. History æ—¶é—´è½´

### 5.1 è®°å½•ç±»å‹
```typescript
interface HistoryRecord {
  id: string;
  timestamp: string;
  type: 'USER_ACTION' | 'SYSTEM_DECISION' | 'PROCESS_EVENT';
  actor: string;           // ç”¨æˆ·ID æˆ– "SYSTEM"
  action: string;          // æ“ä½œæè¿°
  details?: object;        // è¯¦ç»†ä¿¡æ¯
  variables?: object;      // å½“æ—¶çš„å˜é‡å¿«ç…§
}

// ç¤ºä¾‹è®°å½•
const historyExample: HistoryRecord[] = [
  {
    id: 'h1',
    timestamp: '2026-02-18T10:00:00Z',
    type: 'USER_ACTION',
    actor: 'sales01',
    action: 'åˆ›å»ºé”€å”®è®¢å•',
    details: { customerId: 'cust-001', initialAmount: 100000 }
  },
  {
    id: 'h2',
    timestamp: '2026-02-18T10:05:00Z',
    type: 'USER_ACTION',
    actor: 'sales01',
    action: 'æäº¤å®¡æ‰¹',
    details: { submitted: true }
  },
  {
    id: 'h3',
    timestamp: '2026-02-18T10:05:02Z',
    type: 'SYSTEM_DECISION',
    actor: 'SYSTEM',
    action: 'DMNå†³ç­–:ç¡®å®šå®¡æ‰¹çº§åˆ«',
    details: { approvalLevel: 'DIRECTOR', assignee: 'director01' }
  },
  {
    id: 'h4',
    timestamp: '2026-02-18T10:10:00Z',
    type: 'USER_ACTION',
    actor: 'director01',
    action: 'å®¡æ‰¹é€šè¿‡',
    details: { approvalDecision: 'APPROVE', comment: 'åŒæ„' }
  },
  {
    id: 'h5',
    timestamp: '2026-02-18T10:10:05Z',
    type: 'PROCESS_EVENT',
    actor: 'SYSTEM',
    action: 'æµç¨‹å®Œæˆ',
    details: { finalStatus: 'APPROVED' }
  }
];
```

### 5.2 ä¸å¯å˜åŸåˆ™
- **Historyåªå¢ä¸å‡**ï¼šä»»ä½•æ“ä½œï¼ˆåŒ…æ‹¬å›é€€ï¼‰éƒ½äº§ç”Ÿæ–°è®°å½•
- **å›é€€è®°å½•ç¤ºä¾‹**ï¼š
  ```
  10:15 director01 å®¡æ‰¹é€šè¿‡
  10:20 director01 å›é€€åˆ°ä¸Šä¸€æ­¥  â† æ–°å¢è®°å½•ï¼ŒåŸå®¡æ‰¹è®°å½•ä¿ç•™
  10:25 sales01    ä¿®æ”¹è®¢å•ä¿¡æ¯   â† å›åˆ°ä¸Šä¸€æ­¥åçš„æ“ä½œ
  ```

---

## 6. æµç¨‹è¿›åº¦æ¡ï¼ˆHeaderåŒºåŸŸï¼‰

### 6.1 è®¾è®¡å˜æ›´
**v1.1æ›´æ–°**ï¼šæµç¨‹è¿›åº¦æ¡ä»ä¾§è¾¹æ æ”¹ä¸º**æ¨ªå‘æ”¾ç½®äºHeader**

### 6.2 è§†è§‰è®¾è®¡
```
Header
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† è¿”å› | SO-20240218-001  â”‚  [å¼€å§‹]â†’[ğŸ‘¤åˆ›å»º]â†’[ğŸ‘¤éªŒè¯]â†’[ğŸ§ è·¯ç”±]â†’[ğŸ‘¤å®¡æ‰¹]â†’[ğŸå®Œæˆ]  â”‚  APPROVE | æå››  â”‚
â”‚                           â”‚    âœ…      âœ…      â³       â—‹       â—‹      â—‹    â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†‘
                        æ¨ªå‘æµç¨‹è¿›åº¦æ¡ï¼ˆå¯å·¦å³æ»šåŠ¨ï¼‰
```

### 6.3 ç‰¹æ€§
| ç‰¹æ€§ | è¯´æ˜ |
|------|------|
| **æ¨ªå‘å¸ƒå±€** | æ”¾ç½®äºHeaderä¸­é—´åŒºåŸŸ |
| **è¶…å‡ºæ»šåŠ¨** | æ­¥éª¤è¿‡å¤šæ—¶å¯å·¦å³æ»šåŠ¨ |
| **ç®­å¤´æç¤º** | `< >` é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºæ›´å¤šï¼ˆä¸å¯ç‚¹å‡»ï¼‰ |
| **è‡ªåŠ¨å®šä½** | è‡ªåŠ¨æ»šåŠ¨åˆ°å½“å‰æ­¥éª¤ |
| **å›¾æ ‡åŒºåˆ†** | ğŸ‘¤ UserTask / ğŸ§  DMN |

### 6.4 æ»šåŠ¨æç¤º
- å·¦ä¾§è¶…å‡º â†’ æ˜¾ç¤º `<` ç®­å¤´ï¼ˆé¼ æ ‡æ‚¬åœæ»šåŠ¨ï¼‰
- å³ä¾§è¶…å‡º â†’ æ˜¾ç¤º `>` ç®­å¤´ï¼ˆé¼ æ ‡æ‚¬åœæ»šåŠ¨ï¼‰
- **æ³¨**ï¼šç®­å¤´ä»…ç”¨äºæç¤ºï¼Œ**ä¸å¯ç‚¹å‡»**

---

## 7. å¿«æ·å¯¼èˆªï¼ˆæµ®åŠ¨Flowï¼‰

### 7.1 è®¾è®¡å˜æ›´
**v1.1æ›´æ–°**ï¼šå¿«æ·å¯¼èˆªæ”¹ä¸º**æµ®åŠ¨é¢æ¿**ï¼Œæ”¾ç½®åœ¨æ“ä½œåŒºåŸŸä¸Šæ–¹

### 7.2 è§†è§‰è®¾è®¡
```
æ“ä½œåŒºåŸŸ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ ğŸ§­ æµç¨‹å¯¼èˆª              [ğŸ¤–]               â”‚   â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚ â”‚ å·²å®Œæˆ               å½“å‰           å¾…å¤„ç†   â”‚   â”‚
â”‚ â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚ â”‚ â”‚âœ“ åˆ›å»º   â”‚         â”‚â³ éªŒè¯  â”‚    â”‚â—‹ å®¡æ‰¹â”‚ â”‚   â”‚
â”‚ â”‚ â”‚âœ“ æäº¤   â”‚         â”‚  å¤„ç†ä¸­  â”‚    â”‚â—‹ å®Œæˆâ”‚ â”‚   â”‚
â”‚ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚ â”‚                                             â”‚   â”‚
â”‚ â”‚ è¿›åº¦: 2/5  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘           â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                   â”‚
â”‚ ğŸ“ è®¢å•éªŒè¯è¡¨å•                                   â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚ å®¢æˆ·: ä¸Šæµ·åˆ›æ–°é›†å›¢                            â”‚   â”‚
â”‚ â”‚ é‡‘é¢: Â¥274,752                              â”‚   â”‚
â”‚ â”‚ ...                                         â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘
    æµ®åŠ¨å¿«æ·å¯¼èˆªé¢æ¿
```

### 7.3 åŠŸèƒ½ç‰¹æ€§
| åŠŸèƒ½ | è¯´æ˜ |
|------|------|
| **åˆ†ç»„æ˜¾ç¤º** | å·²å®Œæˆ/å½“å‰/å¾…å¤„ç† åˆ†ç»„å±•ç¤º |
| **è¿›åº¦æ¡** | å¯è§†åŒ–æ˜¾ç¤ºæ•´ä½“è¿›åº¦ |
| **å†å²æŸ¥çœ‹** | ç‚¹å‡»å·²å®Œæˆæ­¥éª¤æŸ¥çœ‹å†å²ï¼ˆåªè¯»ï¼‰ |
| **å½“å‰æ ‡è®°** | å½“å‰æ­¥éª¤é«˜äº®æ˜¾ç¤º |
| **Chatbotå…¥å£** | ğŸ¤– æŒ‰é’®æ‰“å¼€æ™ºèƒ½åŠ©æ‰‹ |

### 7.4 Chatbotæ¥å£é¢„ç•™
```typescript
interface ChatbotMessage {
  type: 'user' | 'bot';
  content: string;
  timestamp: string;
}

// é¢„ç•™æ¥å£ï¼šå‘é€æ¶ˆæ¯åˆ°Chatbot
async function sendToChatbot(message: string): Promise<ChatbotResponse> {
  // TODO: é›†æˆLLM API
}
```

**ChatbotåŠŸèƒ½è§„åˆ’**:
- è§£é‡Šå½“å‰æµç¨‹çŠ¶æ€
- å›ç­”å®¡æ‰¹ç›¸å…³é—®é¢˜
- æç¤ºä¸‹ä¸€æ­¥æ“ä½œ
- å†å²è®°å½•æŸ¥è¯¢åŠ©æ‰‹

---

## 7. è¡¨å•æ¸²æŸ“

### 7.1 ä¸Camundaè¡¨å•é›†æˆ
```typescript
// ä»Camundaè·å–ä»»åŠ¡å’Œè¡¨å•å®šä¹‰
async function loadTaskForm(taskId: string) {
  // 1. è·å–ä»»åŠ¡è¯¦æƒ…
  const task = await camundaApi.getTask(taskId);
  
  // 2. è·å–è¡¨å•å®šä¹‰ï¼ˆformKeyï¼‰
  const formKey = task.formKey; // å¦‚ "order-validation"
  
  // 3. ä»Camundaè·å–è¡¨å•schema
  const formSchema = await camundaApi.getFormSchema(formKey);
  
  // 4. æ ¹æ®å½“å‰ç”¨æˆ·æƒé™æ¸²æŸ“
  const permission = getPermissionLevel(currentUser, task);
  const renderedForm = renderFormWithPermission(formSchema, permission);
  
  return renderedForm;
}
```

### 7.2 è¡¨å•æäº¤
```typescript
// æäº¤è¡¨å•åˆ°Camunda
async function submitTaskForm(taskId: string, values: object) {
  // 1. æ„å»ºå˜é‡
  const variables = Object.entries(values).map(([key, value]) => ({
    name: key,
    value: JSON.stringify(value),
    type: typeof value === 'boolean' ? 'Boolean' : 'String'
  }));
  
  // 2. è°ƒç”¨Camunda Complete Task API
  await camundaApi.completeTask(taskId, { variables });
  
  // 3. è§¦å‘æœ¬åœ°çŠ¶æ€æ›´æ–°
  emit('task-completed', { taskId, variables });
}
```

---

## 8. å›é€€æœºåˆ¶

### 8.1 ä¸šåŠ¡è§„åˆ™
- **åªå…è®¸å›é€€ä¸€æ­¥**ï¼šä¸èƒ½è·¨å¤šæ­¥å›é€€
- **ä¿ç•™å†å²**ï¼šåŸå®¡æ‰¹è®°å½•ä¿ç•™ï¼Œæ–°å¢"å›é€€"è®°å½•
- **æƒé™æ£€æŸ¥**ï¼šåªæœ‰å½“å‰å®¡æ‰¹äººå¯ä»¥å›é€€è‡ªå·±çš„å®¡æ‰¹

### 8.2 æŠ€æœ¯å®ç°
ä½¿ç”¨ Camunda Process Instance Modificationï¼š

```typescript
async function rollbackTask(processInstanceId: string, currentTaskId: string) {
  // 1. è·å–å½“å‰æµç¨‹çŠ¶æ€
  const instance = await camundaApi.getProcessInstance(processInstanceId);
  
  // 2. è®¡ç®—å›é€€ç›®æ ‡ï¼ˆä¸Šä¸€ä¸ªUserTaskï¼‰
  const targetActivityId = await findPreviousUserTask(instance, currentTaskId);
  
  // 3. æ‰§è¡Œæµç¨‹ä¿®æ”¹
  await camundaApi.modifyProcessInstance(processInstanceId, {
    instructions: [
      { type: 'cancel', activityId: currentTaskId },  // å–æ¶ˆå½“å‰ä»»åŠ¡
      { type: 'startBeforeActivity', activityId: targetActivityId }  // åœ¨ç›®æ ‡å‰å¯åŠ¨
    ]
  });
  
  // 4. è®°å½•å›é€€å†å²
  await historyService.add({
    type: 'USER_ACTION',
    action: 'å›é€€åˆ°ä¸Šä¸€æ­¥',
    actor: currentUser.id,
    details: { from: currentTaskId, to: targetActivityId }
  });
}
```

---

## 9. å®æ—¶æ¨é€

### 9.1 æ¨é€äº‹ä»¶ç±»å‹
| äº‹ä»¶ | è§¦å‘æ¡ä»¶ | å‰ç«¯å“åº” |
|------|---------|---------|
| `new-task` | æœ‰æ–°ä»»åŠ¡åˆ†é…ç»™å½“å‰ç”¨æˆ· | å¼¹å‡ºé€šçŸ¥ï¼Œæ’­æ”¾æç¤ºéŸ³ï¼Œåˆ·æ–°å¾…åŠåˆ—è¡¨ |
| `task-completed` | å½“å‰SOçš„ä»»åŠ¡è¢«å…¶ä»–äººå®Œæˆ | åˆ·æ–°SOçŠ¶æ€ï¼Œæ˜¾ç¤º"å·²è¢«å¤„ç†"æç¤º |
| `process-completed` | æµç¨‹ç»“æŸ | ç§»åŠ¨åˆ°"å·²å®Œæˆ"åˆ—è¡¨ï¼Œæ˜¾ç¤ºç»“æœ |
| `rollback` | å®¡æ‰¹è¢«å›é€€ | æ˜¾ç¤º"è®¢å•è¢«å›é€€"è­¦å‘Šï¼Œåˆ·æ–°åˆ°å¯¹åº”æ­¥éª¤ |

### 9.2 WebSocketæ¶æ„
```typescript
// åç«¯ï¼šç›‘å¬Camundaäº‹ä»¶ï¼Œæ¨é€åˆ°å‰ç«¯
class PushService {
  private zeebeClient: ZBClient;
  private io: SocketIOServer;
  
  start() {
    // ç›‘å¬æ‰€æœ‰SOæµç¨‹çš„Job
    this.zeebeClient.createWorker('order-validation', async (job) => {
      // å¤„ç†ä»»åŠ¡
      await this.processJob(job);
      
      // æ¨é€ç»™æŒ‡å®šç”¨æˆ·
      this.pushToUser(job.variables.assignee, 'new-task', {
        taskId: job.key,
        orderId: job.variables.orderId,
        type: 'order-validation'
      });
      
      return job.complete();
    });
    
    // ç›‘å¬æµç¨‹å®Œæˆäº‹ä»¶
    this.zeebeClient.createWorker('send-notification', async (job) => {
      this.pushToOrderParticipants(job.variables.orderId, 'process-completed', {
        orderId: job.variables.orderId,
        status: 'COMPLETED'
      });
      
      return job.complete();
    });
  }
  
  private pushToUser(userId: string, event: string, data: object) {
    this.io.to(`user:${userId}`).emit(event, data);
  }
}
```

### 9.3 ç¦»çº¿å¤„ç†
- ç”¨æˆ·ç¦»çº¿æ—¶ï¼Œæ¶ˆæ¯æš‚å­˜äºRedis
- ç”¨æˆ·é‡æ–°è¿æ¥åï¼Œæ¨é€ç¦»çº¿æœŸé—´çš„æ¶ˆæ¯

---

## 10. ç§»åŠ¨ç«¯é€‚é…

### 10.1 PWAé…ç½®
```json
// manifest.json
{
  "name": "PRAM3 SOå®¡æ‰¹",
  "short_name": "SOå®¡æ‰¹",
  "start_url": "/so-list",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#1890ff",
  "icons": [
    { "src": "icon-192.png", "sizes": "192x192" },
    { "src": "icon-512.png", "sizes": "512x512" }
  ]
}
```

### 10.2 æ‰‹åŠ¿æ“ä½œ
```typescript
// ä½¿ç”¨ react-swipeable
function ApprovalCard({ onApprove, onReject }) {
  const handlers = useSwipeable({
    onSwipedRight: () => onApprove(),  // å³æ»‘åŒæ„
    onSwipedLeft: () => onReject(),    // å·¦æ»‘æ‹’ç»
    trackMouse: true
  });
  
  return (
    <div {...handlers} className="approval-card">
      <div className="swipe-hint left">â† å·¦æ»‘æ‹’ç»</div>
      <div className="card-content">...</div>
      <div className="swipe-hint right">å³æ»‘åŒæ„ â†’</div>
    </div>
  );
}
```

### 10.3 å“åº”å¼æ–­ç‚¹
| è®¾å¤‡ | æ–­ç‚¹ | å¸ƒå±€ |
|------|------|------|
| æ‰‹æœº | < 768px | å•åˆ—ï¼Œåº•éƒ¨å›ºå®šæ“ä½œæ  |
| å¹³æ¿ | 768-1024px | åŒåˆ—ï¼Œå·¦ä¾§æµç¨‹å³ä¾§è¡¨å• |
| æ¡Œé¢ | > 1024px | ä¸‰åˆ—ï¼Œæµç¨‹+è¡¨å•+å†å² |

---

## 11. APIæ¥å£

### 11.1 åç«¯REST API
```
GET  /api/v1/orders                    # è·å–SOåˆ—è¡¨
GET  /api/v1/orders/:id                # è·å–SOè¯¦æƒ…
POST /api/v1/orders                    # åˆ›å»ºSO
POST /api/v1/orders/:id/start-process  # å¯åŠ¨å®¡æ‰¹æµç¨‹

GET  /api/camunda/tasks/:orderId       # è·å–SOçš„å½“å‰ä»»åŠ¡
POST /api/camunda/tasks/:taskId/complete # å®Œæˆä»»åŠ¡

GET  /api/forms/:formKey/schema        # è·å–è¡¨å•å®šä¹‰
GET  /api/history/:orderId             # è·å–æ“ä½œå†å²

WS   /ws                               # WebSocketè¿æ¥
```

### 11.2 Camundaé›†æˆAPI
- Tasklist APIï¼šè·å–ä»»åŠ¡ã€è¡¨å•å®šä¹‰
- Zeebe gRPCï¼šå¯åŠ¨æµç¨‹ã€å®Œæˆä»»åŠ¡
- Operate APIï¼šæŸ¥è¯¢æµç¨‹å®ä¾‹çŠ¶æ€

---

## 12. å¼€å‘è®¡åˆ’

| é˜¶æ®µ | ä»»åŠ¡ | å·¥æœŸ |
|------|------|------|
| Phase 1 | åŸºç¡€æ¡†æ¶ã€æƒé™ä½“ç³»ã€è¡¨å•æ¸²æŸ“ | 1å‘¨ |
| Phase 2 | æµç¨‹å›¾ç»„ä»¶ã€Historyæ—¶é—´è½´ | 1å‘¨ |
| Phase 3 | å®æ—¶æ¨é€ã€å›é€€æœºåˆ¶ | 3å¤© |
| Phase 4 | ç§»åŠ¨ç«¯é€‚é…ã€PWAã€æ‰‹åŠ¿ | 3å¤© |
| Phase 5 | è”è°ƒæµ‹è¯• | 2å¤© |

---

## é™„å½•

### A. çŠ¶æ€é¢œè‰²å®šä¹‰
```css
:root {
  --status-completed: #52c41a;  /* ç»¿è‰² */
  --status-current: #fa8c16;    /* æ©™è‰² */
  --status-pending: #d9d9d9;    /* ç°è‰² */
  --status-system: #1890ff;     /* è“è‰² */
  --status-rejected: #f5222d;   /* çº¢è‰² */
}
```

### B. å›¾æ ‡æ˜ å°„
| BPMNå…ƒç´  | å›¾æ ‡ |
|---------|------|
| UserTask | ğŸ‘¤ |
| BusinessRuleTask | ğŸ§  |
| ServiceTask | âš™ï¸ï¼ˆä¸æ˜¾ç¤ºï¼‰ |
| StartEvent | â—ï¼ˆä¸æ˜¾ç¤ºï¼‰ |
| EndEvent | â—†ï¼ˆä¸æ˜¾ç¤ºï¼‰ |

### C. ç›¸å…³æ–‡æ¡£
- `BPMND.md` - BPMNå¼€å‘ç»éªŒ
- `DATABASE.md` - æ•°æ®åº“è®¾è®¡
- `CAMUNDA8_MIGRATION.md` - Camundaé›†æˆ

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0*
*æœ€åæ›´æ–°ï¼š2026-02-18*
*ç¡®è®¤çŠ¶æ€ï¼šå·²ç¡®è®¤*
